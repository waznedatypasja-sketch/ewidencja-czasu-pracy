{% extends "base.html" %}
{% block title %}Do akceptacji{% endblock %}
{% block content %}
<div class="bg-white p-3 rounded shadow-sm">
  <h1 class="h4 mb-3">Wpisy czasu do akceptacji</h1>
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead><tr><th>Pracownik</th><th>Data</th><th>Start</th><th>Koniec</th><th>Przerwa</th><th>Projekt</th><th></th></tr></thead>
      <tbody>
        {% for e in entries %}
          <tr>
            <td>{{ e.user.get_full_name|default:e.user.username }}</td>
            <td>{{ e.date }}</td>
            <td>{{ e.start_time|default:"—" }}</td>
            <td>{{ e.end_time|default:"—" }}</td>
            <td>{{ e.break_minutes }} min</td>
            <td>{{ e.project|default:"—" }}</td>
            <td class="text-end"><button class="btn btn-sm btn-success" type="button" data-bs-toggle="collapse" data-bs-target="#c{{ e.id }}">Decyzja</button></td>
          </tr>
          <tr class="table-light">
            <td colspan="7">
              <div class="small"><strong>Komentarz:</strong> {{ e.comment }}</div>
              {% if e.source == "MANUAL" %}<div class="small text-muted"><strong>Powód wpisu ręcznego:</strong> {{ e.manual_reason }}</div>{% endif %}
              <div class="collapse mt-2" id="c{{ e.id }}">
                <form method="post" action="{% url 'approve_entry' e.id %}" class="mb-2">
                  {% csrf_token %}
                  <label class="form-label small">Uwaga (opcjonalnie)</label>
                  <input class="form-control form-control-sm" name="note">
                  <button class="btn btn-sm btn-success mt-2 w-100">Akceptuj</button>
                </form>
                <form method="post" action="{% url 'reject_entry' e.id %}">
                  {% csrf_token %}
                  <label class="form-label small">Powód odrzucenia (wymagany)</label>
                  <input class="form-control form-control-sm" name="note" required>
                  <button class="btn btn-sm btn-danger mt-2 w-100">Odrzuć</button>
                </form>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="7" class="text-muted">Brak wpisów do akceptacji.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
